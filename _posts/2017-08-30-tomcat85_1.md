---
layout: post
title: "Tomcat8.5源码学习（一）NioEndPoint解析 "
date: 2017-08-13
excerpt: "tomcat"
tags: [tomcat]
--- 

{% include toc.html %}   

1.NioEndPoint在tomcat处理请求中的位置；   
   
    TCP/IP请求到达后，EndPoint负责处理TCP/IP请求，并且交给对应的处理器处理，例如：如果是http的就交给HttpProcessor。
       

2.Nio内部处理环节中的作用；    
     
     Acceptor负责接收TCP/IP请求，对于新的连接则执行serverSocket.accept()。
     Poller轮询调用selector.select()得到“准备好的连接”，实际上这里类似
     while(true)的方式来调用selector.select()
     ### select()可以确保如果连接没有准备好接收数据，就绝对不会在这些连接上浪费时间 ###。
     PollerEvent事实上就是对SelectionKey中event的一次封装。
     SocketProcessor是将制定Socket交给具体handler处理的一次抽象与封装。



### 一、NioEndPoint简介 

NioEndPoint是一款NIO定制的线程池，提供以下服务：   
* Socket acceptor 线程  
* Socket poller 线程    
* Worker 线程池   

启动Tomcat后，NioEndPoint负责创建处理TCP请求的socket
－－PS:
对比NioEndPoint和Nio2EndPoint两个类，但从存在的内部类来说，前者多了Poller和PollerEvent。
先来看看它们的作用是什么。  
![Alt text](../img/in-post/tomcat85/poller.png)    
Poller和PollerEvent     

---------------------------- 
下面说的socket都是SocketWrapper   

------------------------   

##### Poller是用来做什么的呢？   
内部维护了一个PollerEvent的同步循环队列，nextExpiration是下一次到期时间？

摸索中的定义：Pollor最核心作用是驱动selector执行选择操作，哪个socket好了，可以处理了就进行process。

------------------------
##### PollerEvent是用来做什么的呢？   
摸索中的定义：   
如果事件是注册(OP_REGISTER),那么将一个selector和一个socket绑定到一起。如果是其他操作，会将selector和socket的interestOps的值都设置成ops。

------------------------   
##### Acceptor作用是啥呢？  
摸索中的定义：   
The background thread that listens for incoming TCP/IP connections and
hands them off to an appropriate processor.    


------------------------    
##### SocketProcessor  
摸索中的定义： 



  
--PS:NioEndPoint类在Tomcat中的功能   
   socket可以接收UDP和TCP都可以接收吗？

### 二、NioEndPoint继承关系 