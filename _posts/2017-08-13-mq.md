---
layout: post
title: "消息队列随笔"
date: 2017-08-13
excerpt: "消息队列随笔"
tags: [MQ]
--- 

#### 1.概述
消息队列是分布式组件的一种，用于进程间通信或者统一进程中不同线程间的通信。Group communication systems provide similar kinds of functionality.(这种在下面做比较)

消息组件一般支持2种模式：  
* 发送／接收  
* 发布／订阅
#### 2.消息队列能带来什么

https://www.iron.io/top-10-uses-for-message-queue/
##### 2.1 好处  
######  松耦合
在项目一开始很难预测未来会有哪些需求。通过在多个处理之间引入一个基于数据的接口层，使得单独的处理可以独立变化而不影响其它处理（只要坚持满足相同的接口需求）  
--PS:Java中也可以使用interface来定义接口，和这个的不同是什么？

######  冗余   
处理数据的过程有时候会失败。除非这些数据是持久化的，否则将会永久丢失。为了缓解这种状况，队列持久化这些数据，直到完全处理完毕才移除它们。"发送消息->获取消息->删除消息"这个范例被很多消息队列使用。范例中“删除消息”步骤执行前需要一个处理明白得指出他已经处理完这个消息。这么做确保了你的数据可以被安全保存直到被处理完毕。
  
######  可扩展性    
因为消息队列使你的处理之间松耦合，所以仅仅通过增加更多的处理就可以提高消息队列中消息的增加与处理速率，不需要改变代码，不需要调整配置。     
--PS:Process也许可以翻译成其它的，不仅仅是 “处理”。显然这里的处理应该是可以独立运行的存在！！   

######  弹性 & Spikiability (Spiky Load)   
--PS:这个感觉不太好翻译Spiky Load,我感觉就是流量峰值的意思，Spiky是钉子。参考下这个：https://www.iron.io/spikability-applications-ability-to/


##### 可恢复性    
当整个架构中部分失败的时候，不需要整个系统因为这个问题而重启。消息队列使处理直接解耦，所以如果一个处理消息的过程失败并不影响向消息队列中增加消息的过程。当这个问题过程恢复后可以继续处理消息队列中的消息。 This ability to accept requests that will be retried or processed at a later date is often the difference between an inconvenienced customer and a frustrated customer.
  
###### 2.1.2 异步（这个估计不是优点，异步很多实现都是可以达到）   


* 跨系统（Http也是跨系统的>_<）
* 伸缩性提高（多个消费者）
* 保存请求（万一处理的过程中处理失败）

##### 2.2 坏处
* 运维工作量增加
* 不利于程序员调试
* 程序运行起来更容易出现故障

#### 2.什么情况下我们需要引入消息队列

### ForRerference
https://stackoverflow.com/questions/1035949/real-world-use-of-jms-message-queues


#### 3.与消息组件相似技术的比较
##### 3.1 Group communication system

##### 3.2 异步调用，如Spring @Async注解

##### 3.3 进程内queue

##### 3.4 Kafka Compare with traditional Message Entrs  System   
http://kafka.apache.org/documentation.html#kafka_mq   
The advantage of Kafka's model is that every topic has both these properties—it can scale processing and is also multi-subscriber—there is no need to choose one or the other.

#### 4.如何确定是不是真的需要消息队列
##### 4.1 需求是什么？
##### 4.2 根据需求都有哪些可以选择的方案？
##### 4.3 满足需求的最简单方案是什么？

#### 5.建议
##### 5.1 不要为了引入技术而引入

#### 6.参考资料
https://www.iron.io/top-10-uses-for-message-queue/
https://en.wikipedia.org/wiki/Message_queue
https://en.wikipedia.org/wiki/Group_communication_system
https://en.wikipedia.org/wiki/JGroups
https://en.wikipedia.org/wiki/Java_Message_Service
https://techblog.bozho.net/you-probably-dont-need-a-message-queue/
https://www.slideshare.net/Bozho/overview-of-message-queues
https://www.rabbitmq.com/tutorials/tutorial-three-spring-amqp.html
